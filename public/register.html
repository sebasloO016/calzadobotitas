<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Usuario</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    .gradient-custom-2 {
      background: #fccb90;
      background: -webkit-linear-gradient(to right, #ee7724, #d8363a, #dd3675, #b44593);
      background: linear-gradient(to right, #ee7724, #d8363a, #dd3675, #b44593);
    }
    @media (min-width: 768px) {
      .gradient-form {
        height: 100vh !important;
      }
    }
    @media (min-width: 769px) {
      .gradient-custom-2 {
        border-top-right-radius: .3rem;
        border-bottom-right-radius: .3rem;
      }
    }
    .error-message {
      color: red;
    }
  </style>
</head>
<body>
  <section class="h-100 gradient-form" style="background-color: #eee;">
    <div class="container py-5 h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col-xl-10">
          <div class="card rounded-3 text-black">
            <div class="row g-0">
              <div class="col-lg-6">
                <div class="card-body p-md-5 mx-md-4">
                  <div class="text-center">
                    <img src="imagenes/logo botitas.png" style="width: 185px;" alt="logo">
                    <h4 class="mt-1 mb-5 pb-1"><br>REGISTRO DE USUARIOS - BOTITAS</h4>
                  </div>
                  <form id="registerForm">
                    <p>Registra un nuevo usuario</p>
                    <div class="form-outline mb-4">
                      <input type="text" id="nombre" class="form-control" placeholder="Nombre completo" />
                      <label class="form-label" for="nombre">Nombre</label>
                      <div id="nombreError" class="error-message"></div>
                    </div>
                    <div class="form-outline mb-4">
                      <input type="email" id="email" class="form-control" placeholder="Correo electrónico" />
                      <label class="form-label" for="email">Email</label>
                      <div id="emailError" class="error-message"></div>
                    </div>
                    <div class="form-outline mb-4">
                      <input type="password" id="password" class="form-control" />
                      <label class="form-label" for="password">Contraseña</label>
                      <div id="passwordError" class="error-message"></div>
                    </div>
                    <div class="form-outline mb-4">
                      <select id="rol" class="form-control">
                        <option value="Administrador">Administrador</option>
                        <option value="Empleado">Empleado</option>
                      </select>
                      <label class="form-label" for="rol">Rol</label>
                      <div id="rolError" class="error-message"></div>
                    </div>
                    <div class="text-center pt-1 mb-5 pb-1">
                      <button class="btn btn-primary btn-block fa-lg gradient-custom-2 mb-3" type="submit">Registrar</button>
                    </div>
                  </form>
                </div>
              </div>
              <div class="col-lg-6 d-flex align-items-center gradient-custom-2">
                <div class="text-white px-3 py-4 p-md-5 mx-md-4">
                  <h4 class="mb-4">Empresa de calzado desde 1999</h4>
                  <p class="small mb-0">Somos la mejor fábrica y tienda de calzado del centro del país</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script>
    document.getElementById('registerForm').addEventListener('submit', async (event) => {
      event.preventDefault();
      const nombre = document.getElementById('nombre').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const rol = document.getElementById('rol').value;

      let hasError = false;

      if (!nombre) {
        document.getElementById('nombreError').innerText = 'Por favor ingrese el nombre';
        hasError = true;
      } else {
        document.getElementById('nombreError').innerText = '';
      }

      if (!email) {
        document.getElementById('emailError').innerText = 'Por favor ingrese el correo electrónico';
        hasError = true;
      } else {
        document.getElementById('emailError').innerText = '';
      }

      if (!password) {
        document.getElementById('passwordError').innerText = 'Por favor ingrese la contraseña';
        hasError = true;
      } else {
        document.getElementById('passwordError').innerText = '';
      }

      if (!rol) {
        document.getElementById('rolError').innerText = 'Por favor seleccione un rol';
        hasError = true;
      } else {
        document.getElementById('rolError').innerText = '';
      }

      if (hasError) return;

      try {
        const response = await fetch('/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ nombre, email, password, rol })
        });

        const result = await response.json();

        if (response.ok) {
          alert('Usuario registrado exitosamente');
          document.getElementById('registerForm').reset();
        } else {
          document.getElementById('emailError').innerText = result.error || 'Error al registrar el usuario';
        }
      } catch (error) {
        console.error('Error en la solicitud:', error);
        document.getElementById('emailError').innerText = 'Error en la conexión con el servidor';
      }
    });
  </script>
</body>
</html>